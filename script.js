const movies = [
  {
  "title": "Heart Eyes",
  "genre": "Horror, Thriller",
  "rating": "★ 6.9",
  "year": "2025",
  "duration": "1h 35m",
  "type": "Movie",
  "description": "Seorang wanita dikejar oleh sosok bertopeng dengan 'mata hati' yang meneror kota, menyebabkan teror dan kekacauan setiap malam.",
  "trailer": "https://files.catbox.moe/1z0gdw.mp4",
  "poster": "https://i.postimg.cc/XqbK43Jk/images-7.jpg",
  "video": "https://cdn1.turboviplay.com/data1/67f76b8ca1d14/67f76b8ca1d14.m3u8"
},
  {
  "title": "Death of a Unicorn",
  "genre": "Comedy, Fantasy, Horror, Thriller",
  "rating": "★ 6.3",
  "year": "2025",
  "duration": "107min",
  "type": "Movie",
  "description": "Seorang ayah dan putrinya secara tidak sengaja menabrak seekor unicorn saat menuju retret akhir pekan.",
  "trailer": "https://files.catbox.moe/ygknt2.mp4",
  "video": "https://cdn1.turboviplay.com/data1/68128fcd3842f/68128fcd3842f.m3u8",
  "poster": "https://i.postimg.cc/FzSVmV2M/images-6.jpg"
},
  {
  "title": "Exterritorial",
  "genre": "Action, Thriller",
  "rating": "★ 7.4",
  "year": "2025",
  "duration": "109min",
  "type": "Movie",
  "description": "Sara, seorang mantan prajurit pasukan khusus, mengalami mimpi buruk terburuknya ketika putranya menghilang di dalam konsulat AS di Jerman.",
  "trailer": "https://files.catbox.moe/pybl9a.mp4",
  "video": "https://cdn1.turboviplay.com/data1/6812b81d6e8d4/6812b81d6e8d4.m3u8",
  "poster": "https://i.postimg.cc/Jh6yNzYm/MV5-BYj-Vk-Mz-I2-Mj-At-Yz-A3-NC00-OGE1-LWEy-ZDMt-ODc0-YTc5-NTZj-Yz-Fi-Xk-Ey-Xk-Fqc-Gc-V1.jpg"
},
  {
  "title": "Drop",
  "genre": "Thriller, Drama",
  "rating": "★ 7.8",
  "year": "2025",
  "duration": "1h 45m",
  "type": "Movie",
  "description": "Kencan pertama seorang ibu yang sudah lama menjanda berubah menjadi menakutkan ketika dia dibombardir dengan pesan ancaman.",
  "trailer": "https://files.catbox.moe/ug88wn.mp4",
  "poster": "https://i.postimg.cc/xCvxSSKf/images-5.jpg",
  "video": "https://be2719.rcr22.ams01.cdn255.com/hls2/01/08881/norvshst4exk_x/master.m3u8?t=mfs4sHBRyMf-aJJnQcSNOmpBXMZoRZtoDTU63cfSfpQ&s=1746177638&e=10800&f=44406683&srv=18&asn=14061&sp=5500&p="
},
  {
  "title": "Hitman 2",
  "genre": "Action, Thriller",
  "rating": "★ 8.7",
  "year": "2025",
  "duration": "1h 52m",
  "type": "Movie",
  "description": "Seorang pembunuh bayaran kembali dengan misi paling berbahaya yang bisa mengubah takdir dunia.",
  "trailer": "https://files.catbox.moe/e06qe1.mp4",
  "poster": "https://i.postimg.cc/cJV6YptN/images-4.jpg",
  "video": "https://cdn.turboviplay.com/data1/681455b5c79f9/681455b5c79f9.m3u8"
},
  {
  title: "Resident Playbook",
  genre: "Drama, Medical",
  rating: "★ 8.9",
  year: "2025",
  duration: "6 eps",
  type: "Series",
  description: "Kehidupan para residen muda di rumah sakit penuh tantangan, dilema etika, dan ikatan persahabatan yang menguatkan.",
  trailer: "https://files.catbox.moe/dcrfaj.mp4",
  poster: "https://i.ibb.co.com/FLkSZqz4/images-2.jpg",
  Eps: [
    "https://cdn.turboviplay.com/data1/67fb1c027e264/67fb1c027e264.m3u8",
    "https://cdn.turboviplay.com/data1/67fc8bfa631f6/67fc8bfa631f6.m3u8",
    "https://cdn.turboviplay.com/data1/68048b38692d3/68048b38692d3.m3u8",
    "https://cdn.turboviplay.com/data1/6805a0f323dcb/6805a0f323dcb.m3u8",
    "https://cdn.turboviplay.com/data1/680d9a5692298/680d9a5692298.m3u8",
    "https://cdn.turboviplay.com/data1/680ee2768cd22/680ee2768cd22.m3u8"
  ]
},
  {
  title: "YAIBA: Samurai Legend",
  genre: "Action, Samurai, Fantasy",
  rating: "★ 8.7",
  year: "2025",
  duration: "4 eps",
  type: "Series anime",
  description: "Kisah epik samurai muda Yaiba yang berjuang menegakkan keadilan di dunia penuh kekacauan dan kekuatan jahat.",
  trailer: "https://files.catbox.moe/nvgbks.mp4",
  poster: "https://i.postimg.cc/x17QR25M/MV5-BNDc3-Ym-My-ZTkt-ZGQ4-Ni00-Yj-A2-LTk2-Yjgt-ZGFh-MDZj-Zjhl-Mz-Bl-Xk-Ey-Xk-Fqc-Gc-V1.jpg",
  Eps: [
    "https://storages.animein.net/Shin%20Samurai-den%20Yaiba%2F1-720p-1743847904940.mp4",
    "https://storages.animein.net/Shin%20Samurai-den%20Yaiba%2F2-720p-1744453022361.mp4",
    "https://storages.animein.net/Shin%20Samurai-den%20Yaiba%2F3-720p-1745057817698.mp4",
    "https://storages.animein.net/Shin%20Samurai-den%20Yaiba%2F4-720p-1745662342003.mp4",
    "https://storages.animein.net/Shin%20Samurai-den%20Yaiba%2F5-720p-1746268893706.mp4"
  ]
},
  {
  "title": "Neighborhood Watch",
  "genre": "Thriller, Mystery",
  "rating": "★ 7.2",
  "year": "2025",
  "duration": "108min",
  "type": "Movie",
  "description": "Sebuah lingkungan pinggiran kota yang tampak tenang berubah menjadi medan penuh kecurigaan dan teror ketika serangkaian kejadian misterius mengungkap rahasia gelap para penghuninya.",
  "trailer": "https://files.catbox.moe/hfm1pi.mp4",
  "video": "https://cdn1.turboviplay.com/data1/680e4460e3ae6/680e4460e3ae6.m3u8",
  "poster": "https://s6.lk21static.buzz/wp-content/uploads/2025/04/film-neighborhood-watch-2025-lk21-d21.jpg.webp"
},
      {
  "title": "Armed",
  "genre": "Action, Horror, Thriller",
  "rating": "★ 6.2",
  "year": "2025",
  "duration": "94min",
  "type": "Movie",
  "description": "Sekelompok marinir veteran mencuri senjata militer, namun tanpa sengaja membangkitkan robot era Perang Dingin yang diprogram untuk memburu mereka tanpa ampun.",
  "trailer": "https://files.catbox.moe/abvaax.mp4",
  "video": "https://cdn1.turboviplay.com/data1/6810968e3b893/6810968e3b893.m3u8",
  "poster": "https://i.postimg.cc/MTgM1VBJ/p29406524-v-v13-aa.jpg"
},
    {
      "title": "Last Breath ",
      "genre": "Thriller, Mystery",
      "rating": "★ 6.8",
      "year": "2025",
      "duration": "115min",
      "type": "Movie",
      "description": "Seorang penyelam yang terjebak di dasar laut tanpa oksigen harus berjuang untuk bertahan hidup melawan waktu dan ketakutan terbesar dalam hidupnya.",
      "trailer": "https://files.catbox.moe/3laeli.mp4",
      "video": "https://cdn1.turboviplay.com/data1/6809d3b125bc5/6809d3b125bc5.m3u8",
      "poster": "https://i.postimg.cc/pTPkG1sJ/MV5-BYm-Nj-MDg1-Y2-Et-Nm-Zi-OS00-NGUz-LThj-ZGYt-Nz-U2-OGI5-M2-Vk-MDFh-Xk-Ey-Xk-Fqc-Gc-V1.jpg"
    },
    {
      "title": "Freaky Tales ",
      "genre": "Horror, Thriller",
      "rating": "★ 6.8",
      "year": "2025",
      "duration": "110min",
      "type": "Movie",
      "description": "Sekelompok teman menghadapi kejadian mengerikan ketika mereka menemukan buku kuno yang membawa mereka ke dalam dunia kegelapan yang tak terbayangkan.",
      "trailer": "https://files.catbox.moe/cb40vj.mp4",
      "video": "https://cdn1.turboviplay.com/data1/680daaf4d57d1/680daaf4d57d1.m3u8",
      "poster": "https://i.postimg.cc/BvbnTq0T/MV5-BMTUx-Nzk2-Nj-At-NGY2-My00-ZTVj-LTkx-YTQt-MWUz-ODUw-Nz-M3-NDhk-Xk-Ey-Xk-Fqc-Gc-V1.jpg"
    },
    {
      "title": "Havoc ",
      "genre": "Action, Thriller",
      "rating": "★ 7.5",
      "year": "2025",
      "duration": "135min",
      "type": "Movie",
      "description": "Seorang detektif yang sedang terjerat dalam dunia kriminal harus mengungkap rahasia besar sambil berjuang untuk menyelamatkan keluarganya.",
      "trailer": "https://files.catbox.moe/35wfot.mp4",
      "video": "https://cdn1.turboviplay.com/data1/680c38c55bebc/680c38c55bebc.m3u8",
      "poster": "https://i.postimg.cc/LXqhpmQ9/ems-c-HJk-LWVtcy1hc3-Nld-HMvb-W92a-WVz-Lz-Jl-NTkw-NTIx-LTM0-Ym-Yt-NDgz-Ni1h-ZGFl-LThj-ODM2-ZTA5-OTEz-Mi5qc-Gc-1.jpg"
    },
    {
      title: "Weak Hero Class 2 ",
      genre: "Action, Drama",
      rating: "★ 9.2",
      year: "2025",
      duration: "8 eps",
      type: "Series",
      description: "Yeon Si Eun kembali menghadapi tantangan baru di dunia sekolah keras yang brutal.",
      trailer: "https://files.catbox.moe/8g9571.mp4",
      poster: "https://i.postimg.cc/xCfzyRRj/images.jpg",
      Eps: [
        "https://cdn.turboviplay.com/data1/680b770dbbeef/680b770dbbeef.m3u8",
        "https://cdn.turboviplay.com/data1/680b7ce80bae4/680b7ce80bae4.m3u8",
        "https://cdn.turboviplay.com/data1/680b819204fa4/680b819204fa4.m3u8",
        "https://cdn.turboviplay.com/data1/680b864694917/680b864694917.m3u8",
        "https://cdn.turboviplay.com/data1/680b89c93ec8d/680b89c93ec8d.m3u8",
        "https://cdn.turboviplay.com/data1/680b8e78c1ea4/680b8e78c1ea4.m3u8",
        "https://cdn.turboviplay.com/data1/680b932732ad4/680b932732ad4.m3u8",
        "https://cdn.turboviplay.com/data1/680b9a58a7748/680b9a58a7748.m3u8"
      ]
    },
    {
  title: "Study Group",
  genre: "Action, School, Drama",
  rating: "★ 9.0",
  year: "2025",
  duration: "12 eps",
  type: "Series",
  description: "Gamin, siswa cerdas di sekolah brutal, membentuk kelompok belajar demi bertahan hidup dan mencapai impiannya.",
  trailer: "https://files.catbox.moe/ya3lh5.mp4",
  poster: "https://i.ibb.co.com/mC14pmyf/images-3.jpg",
  Eps: [
    "https://be6721.rcr72.waw04.cdn255.com/hls2/01/08114/c4fz4scj0zf7_x/master.m3u8?t=Bdmps_ihsNAmOrUD1ZTvj5Jj0AvylzEbrAaz19DBQs4&s=1745983478&e=10800&f=40574193&srv=36&asn=45146&sp=5500&p=",
    "https://be6721.rcr72.waw04.cdn255.com/hls2/01/08114/gweasg25sxdl_x/master.m3u8?t=BWAeofoBLfOuhLLbVXM5oPFCNd9oCqOnYAca2si_fBY&s=1745983578&e=10800&f=40574659&srv=50&asn=45146&sp=5500&p=",
    "https://cdn.turboviplay.com/data1/679c5b6210256/679c5b6210256.m3u8",
    "https://cdn.turboviplay.com/data1/679c600e8fa4e/679c600e8fa4e.m3u8",
    "https://cdn.turboviplay.com/data1/67a57ae8e861d/67a57ae8e861d.m3u8",
    "https://cdn.turboviplay.com/data1/67a57fa033a9f/67a57fa033a9f.m3u8",
    "https://cdn.turboviplay.com/data1/67af238a80499/67af238a80499.m3u8",
    "https://cdn.turboviplay.com/data1/67af29688ac48/67af29688ac48.m3u8",
    "https://cdn.turboviplay.com/data1/67b7eb3222145/67b7eb3222145.m3u8",
    "https://cdn.turboviplay.com/data1/67b7efe0a1b2b/67b7efe0a1b2b.m3u8"
  ]
},
    {
      title: "Locked ",
      genre: "Thriller",
      rating: "★ 8.9",
      year: "2025",
      duration: "120min",
      type: "Movie",
      description: "Seorang pencuri masuk ke SUV mewah dan menemukan dirinya dalam permainan psikologis horor.",
      trailer: "https://files.catbox.moe/xthmdm.mp4",
      video: "https://cdn1.turboviplay.com/data1/680943909ce01/680943909ce01.m3u8",
      poster: "https://i.postimg.cc/xjcgfhBZ/MV5-BZjg2-NDFh-ZDEt-Yz-Zl-ZC00-ZTRk-LTg4-NDct-Yj-Iw-NTQx-YWY4-ODFi-Xk-Ey-Xk-Fqc-Gc-V1.jpg"
    },
    {
      title: "A Working Man ",
      genre: "Drama",
      rating: "★ 7.8",
      year: "2025",
      duration: "110min",
      type: "Movie",
      description: "Seorang ayah bekerja keras menghadapi tantangan hidup demi keluarganya.",
      trailer: "https://files.catbox.moe/cqyhoh.mp4",
      video: "https://cdn1.turboviplay.com/data1/68094abf5703a/68094abf5703a.m3u8",
      poster: "https://i.postimg.cc/3JGBpp8C/MV5-BYm-Qx-ZGIx-NTYt-YTQw-My00-ODdk-LWI0-Mm-Qt-M2-E0-Zm-Iy-Nm-Yz-MGMz-Xk-Ey-Xk-Fqc-Gc-V1-FMjpg-UX1000.jpg"
    }
  ];
// ===== ELEMEN UI ===== //
const searchInput = document.getElementById("searchInput");
const genreSelect = document.getElementById("Genreselect");
const movieGrid = document.getElementById("movie-grid");
const modal = document.getElementById("video-modal");
const modalVideo = document.getElementById("modal-video");
const playButton = document.getElementById("play-btn");
const introVideo = document.getElementById("intro-video");
const overlay = document.getElementById("poster-overlay");
const genreEl = document.getElementById("genre");
const titleEl = document.getElementById("film-title");
const metaEl = document.getElementById("meta-info");
const descEl = document.getElementById("film-desc");
const EpButtons = document.getElementById("Ep-buttons");

let currentFilm = movies[0];
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// ===== FUNGSI UTAMA ===== //
function renderMovies(moviesToShow) {
  movieGrid.innerHTML = '';
  
  if (moviesToShow.length > 0) {
    moviesToShow.forEach(movie => {
      const div = document.createElement("div");
      div.innerHTML = `
        <img src="${movie.poster}" alt="${movie.title}">
        <div class="grid-title">${movie.title}</div>
      `;
      div.onclick = () => loadFilm(movie);
      movieGrid.appendChild(div);
    });
  } else {
    movieGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #ccc;">Tidak ada film yang sesuai</p>';
  }
}

function loadFilm(film) {
  // Hentikan semua video
  introVideo.pause();
  introVideo.currentTime = 0;
  modalVideo.pause();
  modalVideo.currentTime = 0;

  // Set poster dan trailer
  overlay.style.backgroundImage = `url('${film.poster}')`;
  overlay.style.opacity = 1;
  
  introVideo.src = film.trailer;
  introVideo.load();

  introVideo.oncanplay = () => {
    overlay.style.opacity = 0;
    introVideo.play()
      .then(() => introVideo.muted = false)
      .catch(e => {
        console.log("Autoplay diblokir, menggunakan muted");
        introVideo.muted = true;
        introVideo.play();
      });
  };

  // Update info film
  genreEl.textContent = film.genre;
  titleEl.textContent = film.title;
  metaEl.textContent = `${film.rating} · ${film.year} · ${film.duration} · ${film.type}`;
  descEl.textContent = film.description;
  
  // Handle episode buttons
  EpButtons.innerHTML = '';
  if (film.Eps) {
    film.Eps.forEach((ep, i) => {
      const btn = document.createElement('button');
      btn.textContent = `Ep ${i+1}`;
      btn.onclick = () => playVideo(ep, i);
      EpButtons.appendChild(btn);
    });
  }
  currentFilm = film;
}

function applyFilters() {
  const searchTerm = searchInput.value.trim();
  const genre = genreSelect.value;
  
  let filteredMovies = [...movies];
  
  if (searchTerm) {
    filteredMovies = filteredMovies.filter(movie => 
      movie.title.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }
  
  if (genre) {
    filteredMovies = filteredMovies.filter(movie => 
      movie.genre.toLowerCase().includes(genre.toLowerCase())
    );
  }
  
  renderMovies(filteredMovies);
}

function closeModal() {
  modal.style.display = "none";
  modalVideo.pause();
  modalVideo.currentTime = 0;
  
  if (document.fullscreenElement) {
    document.exitFullscreen().catch(e => console.log("Fullscreen exit error:", e));
  }
  
  history.pushState({ modalClosed: true }, "");
}

function openVideoModal() {
  introVideo.pause();
  introVideo.currentTime = 0;
  introVideo.removeAttribute('src');
  
  modal.style.display = "flex";
  
  if (isMobile) {
    modalVideo.setAttribute('controls', '');
    modalVideo.setAttribute('playsinline', '');
    modalVideo.setAttribute('webkit-playsinline', '');
    modalVideo.play().catch(e => {
      console.log("Mobile play error:", e);
      modalVideo.muted = true;
      modalVideo.play();
    });
  } else {
    modalVideo.requestFullscreen().then(() => {
      modalVideo.play();
    }).catch(e => {
      console.log("Fullscreen error:", e);
      modalVideo.play();
    });
  }
  
  history.pushState({ modalOpen: true }, "");
}

function playVideo(source, episodeIndex = 0) {
  introVideo.pause();
  introVideo.currentTime = 0;
  introVideo.src = "";
  
  modalVideo.pause();
  modalVideo.currentTime = 0;
  modalVideo.src = "";

  if (source.endsWith('.mp4')) {
    modalVideo.src = source;
    modalVideo.type = 'video/mp4';
  } else if (source.endsWith('.m3u8')) {
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(source);
      hls.attachMedia(modalVideo);
    } else if (modalVideo.canPlayType('application/vnd.apple.mpegurl')) {
      modalVideo.src = source;
    }
  }

  modalVideo.onended = () => {
    if (currentFilm.Eps && episodeIndex < currentFilm.Eps.length - 1) {
      playVideo(currentFilm.Eps[episodeIndex + 1], episodeIndex + 1);
    }
  };

  modal.style.display = "flex";
  modalVideo.play().catch(e => {
    console.log("Autoplay diblokir, menggunakan muted");
    modalVideo.muted = true;
    modalVideo.play();
  });
}

function initSplashScreen() {
  const splashScreen = document.getElementById('splash-screen');
  const mainContent = document.querySelector('body > :not(#splash-screen)');
  
  // Sembunyikan semua konten kecuali splash screen
  mainContent.style.opacity = '0';
  mainContent.style.pointerEvents = 'none';
  
  setTimeout(() => {
    splashScreen.classList.add('fade-out');
    
    setTimeout(() => {
      splashScreen.style.display = 'none';
      mainContent.style.opacity = '1';
      mainContent.style.pointerEvents = 'auto';
      
      // Inisialisasi konten utama
      renderMovies(movies);
      loadFilm(currentFilm);
      setupEventListeners();
    }, 00);
  }, 3000);
}

function setupEventListeners() {
  searchInput.addEventListener("input", applyFilters);
  genreSelect.addEventListener("change", applyFilters);
  
  playButton.addEventListener('click', () => {
    const videoSource = currentFilm.video || (currentFilm.Eps && currentFilm.Eps[0]);
    if (videoSource) playVideo(videoSource, 0);
    else alert("Video tidak tersedia");
  });
  
  document.getElementById('close-modal').addEventListener('click', closeModal);
  document.getElementById('close-modal').addEventListener('touchend', (e) => {
    e.preventDefault();
    closeModal();
  });
  
  window.addEventListener('popstate', (e) => {
    if (modal.style.display === "flex") {
      e.preventDefault();
      closeModal();
      setTimeout(() => history.pushState({ modalPreventExit: true }, ""), 10);
    }
  });
  
  window.addEventListener('beforeunload', (e) => {
    if (modal.style.display === "flex") {
      e.preventDefault();
      return "Anda sedang menonton video. Yakin ingin keluar?";
    }
  });
}

// Inisialisasi saat halaman load
window.addEventListener('DOMContentLoaded', () => {
  // Pastikan HLS.js tersedia
  if (typeof Hls === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/hls.js@latest';
    script.onload = initSplashScreen;
    document.head.appendChild(script);
  } else {
    initSplashScreen();
  }
});